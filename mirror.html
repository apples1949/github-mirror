<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>GitHub Mirror 文件加速</title>
    <link rel="icon" href="dist/icon.svg"/>
    <meta name="description" content='github 文件加速'>
    <meta name="anthor" content="xiaoxuan6">
    <link rel="stylesheet" href="dist/css/tailwind.min.css"/>
    <link rel="stylesheet" href="https://unpkg.com/nprogress@0.2.0/nprogress.css">
</head>
<body class="bg-gray-200 h-screen">
<div class="flex flex-col">
    <p class="font-bold text-4xl mx-4 my-4">Github-Mirror</p>
    <div class="bg-white mx-4 mb-4 p-4 rounded-lg shadow">
        <p class="font-bold">随机复制一个节点，添加到 git 地址前面即可</p>
        <div class="flex">
            <p class="font-bold">例如：
            <div class="bg-red-500 text-white">https://example.com</div>
            /https://github.com/xiaoxuan6/github-mirror/blob/main/README.md</p>
        </div>
    </div>
</div>
<div class="bg-white mx-4 mb-4 p-4 rounded-lg shadow">
    <table class="table-auto w-full">
        <tbody id="tbody">
        </tbody>
    </table>
</div>
</div>
<script src="dist/js/clipboard.min.js"></script>
<script src="dist/js/notiflix-3.2.6.min.js"></script>
<script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
<script>
    (function () {
        function initializeClipboard() {
            let clipboard = new ClipboardJS('.btn');

            clipboard.on('success', function (e) {
                console.info('Text:', e.text);
            });

            clipboard.on('error', function (e) {
                console.info('Action:', e.action);
            });
        }

        window.addEventListener("load", function () {
            NProgress.start();
            fetch("/api/urls")
                .then((res) => {
                    if (res.ok === false) {
                        console.error("请求失败，状态码: " + res.status);
                    }

                    return res.json()
                })
                .then((data) => {
                    NProgress.done();
                    if (data.code !== 200) {
                        Notiflix.Notify.failure('数据加载失败！' + data.msg);
                        return
                    }

                    let i = 1
                    let td = ''
                    let items = data.data
                    let tbody = document.getElementById("tbody");

                    for (let url of items) {

                        let uri = url.trim()
                        let id = uri.replaceAll('.', '-').replaceAll('://', '-').replace(':', '-')
                        td += '<td class="border p-2 text-center" id="' + id + '">\n' + uri +
                            '       <button class="btn" data-clipboard-target="#' + id + '" data-clipboard-action="copy">\n' +
                            '           <img src="./dist/clippy.svg" width="16"/>\n' +
                            '       </button>' +
                            '</td>'

                        if (i % 5 === 0 || items.length === i) {
                            let tr = document.createElement('tr')
                            tr.innerHTML = td
                            tbody.appendChild(tr)
                            td = ''
                        }

                        i++
                    }
                })
                .catch((error) => {
                    NProgress.done();
                    Notiflix.Notify.failure('请求失败：' + error);
                });

            initializeClipboard()
        });
    })();
</script>
</body>
</html>
